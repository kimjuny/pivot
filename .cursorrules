## Python Development Rules

### Code Quality Standards

All Python code must strictly adhere to the configuration defined in `server/pyproject.toml`:

### Ruff Configuration

-**Line Length**: 88 characters.

-**Target Version**: Python 3.10 (for maximum open-source compatibility).

-**Rule Sets Enabled**:

-`E`, `F`: Basic errors and standard lints.

-`I`: Automated import sorting.

-`B`: Bugbear (detects common design flaws).

-`UP`: Pyupgrade (ensures modern 3.10 syntax).

-`N`: Naming conventions (enforces `snake_case` for functions/variables).

-`C4`: Comprehensions (optimizes list/dict/set creation).

-`PTH`: Pathlib (mandates `pathlib.Path` over `os.path`).

-`SIM`: Simplify (suggests simpler code structures).

-`TCH`: Type-checking blocks (manages imports used only for types).

-**Formatting**: Use double quotes (`"`) and 4-space indentation.

### Pyright Configuration

-**Type Checking Mode**: `standard`.

-**Python Version**: 3.10.

-**Strict Rules**:

    -`reportOptionalMemberAccess`: **Error** (Explicit None-checks are mandatory).

    -`reportGeneralTypeIssues`: **Error**.

    -`reportUnusedImport`: **Warning**.

    -`reportUnusedVariable`: **Warning**.

### Development Workflow

Before committing or completing a task, you MUST perform these steps in the `server` directory:

1. Run `ruff check . --fix` to resolve linting and import issues.
2. Run `ruff format .` to ensure consistent code styling.
3. Run `pyright .` to verify type integrity.

### Strategic Coding Requirements

-**Type Hints**: Mandatory for all function signatures and class members.

-**None-Safety**: You MUST handle `Optional` types explicitly. Never access attributes of an object that could be `None` without a guard (e.g., `if object is not None:`).

-**Modern Syntax**: Prefer `T | None` over `Optional[T]` for Union types (Python 3.10 style).

-**Naming**: Use `snake_case` for variables/functions and `PascalCase` for classes.

-**Path Handling**: Always use `pathlib.Path`. String-based path manipulation is discouraged.

### Import Organization

-**Order**: Follow `isort` rules (Standard library > Third-party > First-party).

-**First-party**: `core` and `server` are recognized as local modules.

-**Circular Dependencies**: Use `if TYPE_CHECKING:` blocks for imports required only for type annotations.

### Core Module Integration

- The project uses a multi-module structure with `./core/` and `./server/`.
- Access shared logic via `import core.xxx`.
- The `extraPaths = ["../"]` setting in `pyproject.toml` ensures that `server` can resolve types from `core`. Do not break this resolution.

### Testing

-**Testing**: New features should include unit tests. Ensure existing tests pass before finishing.

### Documentation & Style

#### Docstring Standards

- **Format**: Follow **Google Style Docstrings** for all public functions, classes, and methods.
- **Mandatory Fields**:
  - `Args`: List all parameters with their purposes.
  - `Returns`: Describe the return value and its type.
  - `Raises`: Document all exceptions that are explicitly raised.
- **Example Pattern**:
  ```python
  def get_agent_status(agent_id: str, verbose: bool = False) -> dict | None:
      """Fetches the current status of a specific agent.

      Args:
          agent_id: The unique identifier of the agent.
          verbose: If True, returns detailed metadata.

      Returns:
          A dictionary containing status info, or None if the agent doesn't exist.

      Raises:
          ConnectionError: If the core database is unreachable.
      """
  ```

#### AI Commentary Rules

- **No Redundancy**: Do not write comments that state the obvious (e.g., `# Increment i by 1`).
- **Explain "Why", Not "What"**: Use comments to explain complex logic, business rules, or "hacks" that aren't immediately clear from the code itself.
- **Side Effects**: Clearly document any side effects (e.g., if a function modifies a global state or writes to a file).
- **TODO Management**: Use `TODO(username): description` for temporary hacks or planned features.

#### Project Context

- All documentation must be in **English** as this is an international open-source project.
- Ensure that descriptions of `core` module integrations are clear enough for external contributors to understand the data flow.